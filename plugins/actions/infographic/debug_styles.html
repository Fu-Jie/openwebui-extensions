<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿¡æ¯å›¾æ ·å¼è°ƒè¯•</title>
    <script src="https://registry.npmmirror.com/@antv/infographic/0.2.1/files/dist/infographic.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        .debug-container {
            display: flex;
            gap: 20px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .controls {
            width: 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .controls h2 {
            margin-top: 0;
            font-size: 16px;
        }

        .controls label {
            display: block;
            margin: 12px 0 4px;
            font-size: 14px;
            color: #666;
        }

        .controls input,
        .controls select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .controls button {
            width: 100%;
            padding: 10px;
            margin-top: 16px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

        .controls button:hover {
            background: #4f46e5;
        }

        .preview {
            flex: 1;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        #infographic-container {
            min-height: 500px;
            padding: 24px;
        }

        /* ========== å¯è°ƒè¯•çš„æ ·å¼ ========== */
        /* è¿™äº›æ ·å¼å¯ä»¥ç›´æ¥åœ¨è¿™é‡Œä¿®æ”¹ï¼Œåˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°æ•ˆæœ */

        /* åŸºç¡€å­—ä½“ */
        #infographic-container svg text {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif !important;
        }

        #infographic-container svg foreignObject {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif !important;
            line-height: 1.4 !important;
        }

        /* æ ‡é¢˜æ ·å¼ - æ ¹æ®éœ€è¦è°ƒæ•´ */
        #infographic-container svg foreignObject h1,
        #infographic-container svg foreignObject [class*="title"] {
            font-size: 0.8em !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }

        #infographic-container svg foreignObject h2,
        #infographic-container svg foreignObject [class*="subtitle"] {
            font-size: 0.85em !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
        }

        /* ========== è°ƒè¯•æ ·å¼ç»“æŸ ========== */
    </style>
</head>

<body>
    <div class="debug-container">
        <div class="controls">
            <h2>ğŸ”§ æ ·å¼è°ƒè¯•é¢æ¿</h2>

            <label>ä¸€çº§æ ‡é¢˜å­—ä½“å¤§å°</label>
            <input type="text" id="h1-size" value="1.2em" placeholder="ä¾‹å¦‚: 1.2em, 20px">

            <label>äºŒçº§æ ‡é¢˜å­—ä½“å¤§å°</label>
            <input type="text" id="h2-size" value="0.6em" placeholder="ä¾‹å¦‚: 0.6em, 12px">

            <label>æ ‡é¢˜æ¢è¡Œè®¾ç½®</label>
            <select id="title-wrap">
                <option value="nowrap">ä¸æ¢è¡Œ (nowrap)</option>
                <option value="normal">è‡ªåŠ¨æ¢è¡Œ (normal)</option>
            </select>

            <label>è¡Œé«˜</label>
            <input type="text" id="line-height" value="1.4" placeholder="ä¾‹å¦‚: 1.4, 1.6">

            <button onclick="applyStyles()">åº”ç”¨æ ·å¼</button>
            <button onclick="reRender()" style="background: #10b981; margin-top: 8px;">é‡æ–°æ¸²æŸ“</button>

            <hr style="margin: 20px 0; border: none; border-top: 1px solid #eee;">

            <label>è‡ªå®šä¹‰è¯­æ³•å†…å®¹</label>
            <textarea id="syntax-input" rows="10" style="width: 100%; font-size: 12px; font-family: monospace;">infographic list-grid
data
  title 2025èŒä¸šè¶³çƒè¿åŠ¨å‘˜æˆåŠŸè¦ç´ è§£æ
  desc åœ¨é«˜åº¦ç«äº‰çš„ç°ä»£è¶³çƒä½“ç³»ä¸‹ï¼Œä»å¤©èµ‹åˆ°èŒä¸šçš„è¿›åŒ–è·¯å¾„
  items
    - label æ ¸å¿ƒå…¥åœºåˆ¸ï¼šå¤©èµ‹ä¸èº«ä½“
      desc é€Ÿåº¦ã€çˆ†å‘åŠ›åŠæä½³çš„çƒæ„Ÿæ˜¯åº•çº¿ã€‚åŸºæœ¬åŠŸå¿…é¡»åŒ–ä¸ºè‚Œè‚‰è®°å¿†ã€‚
      icon mdi/lightning-bolt
    - label å†³å®šä¸Šé™ï¼šæåº¦è‡ªå¾‹
      desc åŒ…å«ä¸¥è‹›çš„é¥®é£Ÿã€ç¡çœ ç®¡ç†åŠå¼ºå¤§çš„æŠ—å‹å¿ƒæ€ã€‚
      icon mdi/shield-star
    - label ç°ä»£æ™ºæ…§ï¼šçƒå•† (IQ)
      desc å¤æ‚çš„æˆ˜æœ¯ç†è§£åŠ›ä¸é˜…è¯»æ¯”èµ›èƒ½åŠ›ã€‚
      icon mdi/brain
    - label éšå½¢æ¨æ‰‹ï¼šæœºé‡ä¸å¹³å°
      desc ä¸“ä¸šçš„é’è®­ä½“ç³»ã€èƒ½å‘æ˜ä½ çš„ä¼¯ä¹ã€‚
      icon mdi/star-shooting</textarea>
        </div>

        <div class="preview">
            <div id="infographic-container"></div>
        </div>
    </div>

    <script>
        function applyStyles() {
            console.log('[Debug] åº”ç”¨æ ·å¼åˆ°å·²æ¸²æŸ“çš„å…ƒç´ ...');

            const h1Size = document.getElementById('h1-size').value;
            const h2Size = document.getElementById('h2-size').value;
            const titleWrap = document.getElementById('title-wrap').value;
            const lineHeight = document.getElementById('line-height').value;

            const container = document.getElementById('infographic-container');

            // ç›´æ¥æ“ä½œ SVG å†…çš„æ‰€æœ‰æ–‡æœ¬å…ƒç´ 
            const allTexts = container.querySelectorAll('svg text');
            allTexts.forEach(text => {
                text.style.setProperty('font-size', h1Size, 'important');
            });

            // æ“ä½œ foreignObject å†…çš„æ‰€æœ‰å…ƒç´ 
            const foreignObjects = container.querySelectorAll('svg foreignObject');
            let mainTitleCount = 0;
            let itemLabelCount = 0;
            let itemDescCount = 0;
            let otherCount = 0;

            foreignObjects.forEach(fo => {
                // æ£€æŸ¥ foreignObject è‡ªèº«çš„ data-element-type å±æ€§
                const elementType = fo.getAttribute('data-element-type');

                // è®¾ç½® foreignObject æœ¬èº«çš„è¡Œé«˜
                fo.style.setProperty('line-height', lineHeight, 'important');

                // è·å–å†…éƒ¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆé€šå¸¸æ˜¯ spanï¼‰
                const firstChild = fo.querySelector(':scope > *');

                if (!firstChild) return;

                // æ ¹æ® foreignObject çš„ç±»å‹è®¾ç½®æ ·å¼
                if (elementType === 'title') {
                    // ä¸»æ ‡é¢˜
                    mainTitleCount++;
                    firstChild.style.setProperty('font-size', h1Size, 'important');
                    firstChild.style.setProperty('font-weight', 'bold', 'important');
                    firstChild.style.setProperty('line-height', lineHeight, 'important');
                    if (titleWrap === 'nowrap') {
                        firstChild.style.setProperty('white-space', 'nowrap', 'important');
                        firstChild.style.setProperty('overflow', 'hidden', 'important');
                        firstChild.style.setProperty('text-overflow', 'ellipsis', 'important');
                    } else {
                        firstChild.style.setProperty('white-space', 'normal', 'important');
                        firstChild.style.setProperty('overflow', 'visible', 'important');
                        firstChild.style.setProperty('text-overflow', 'clip', 'important');
                    }
                } else if (elementType === 'desc') {
                    // é¡µé¢å‰¯æ ‡é¢˜ï¼ˆä¸»æ ‡é¢˜ä¸‹æ–¹çš„æè¿°ï¼‰
                    itemLabelCount++; // å½’å…¥å‰¯æ ‡é¢˜è®¡æ•°
                    firstChild.style.setProperty('font-size', h2Size, 'important');
                    firstChild.style.setProperty('line-height', lineHeight, 'important');
                    if (titleWrap === 'nowrap') {
                        firstChild.style.setProperty('white-space', 'nowrap', 'important');
                        firstChild.style.setProperty('overflow', 'hidden', 'important');
                        firstChild.style.setProperty('text-overflow', 'ellipsis', 'important');
                    } else {
                        firstChild.style.setProperty('white-space', 'normal', 'important');
                        firstChild.style.setProperty('overflow', 'visible', 'important');
                        firstChild.style.setProperty('text-overflow', 'clip', 'important');
                    }
                } else if (elementType === 'item-label') {
                    // å¡ç‰‡æ ‡é¢˜
                    itemLabelCount++;
                    firstChild.style.setProperty('font-size', h2Size, 'important');
                    firstChild.style.setProperty('line-height', lineHeight, 'important');
                    if (titleWrap === 'nowrap') {
                        firstChild.style.setProperty('white-space', 'nowrap', 'important');
                        firstChild.style.setProperty('overflow', 'hidden', 'important');
                        firstChild.style.setProperty('text-overflow', 'ellipsis', 'important');
                    } else {
                        firstChild.style.setProperty('white-space', 'normal', 'important');
                        firstChild.style.setProperty('overflow', 'visible', 'important');
                        firstChild.style.setProperty('text-overflow', 'clip', 'important');
                    }
                } else if (elementType === 'item-desc') {
                    // å¡ç‰‡æè¿°
                    itemDescCount++;
                    firstChild.style.setProperty('line-height', lineHeight, 'important');
                    firstChild.style.setProperty('white-space', 'normal', 'important');
                } else {
                    // å…¶ä»–å…ƒç´ 
                    otherCount++;
                    firstChild.style.setProperty('line-height', lineHeight, 'important');
                    firstChild.style.setProperty('white-space', 'normal', 'important');
                }
            });

            console.log('[Debug] foreignObject å¤„ç†:', 'ä¸»æ ‡é¢˜:', mainTitleCount, 'å¡ç‰‡æ ‡é¢˜:', itemLabelCount, 'å¡ç‰‡æè¿°:', itemDescCount, 'å…¶ä»–:', otherCount);

            console.log('[Debug] æ ·å¼å·²åº”ç”¨åˆ°', allTexts.length, 'ä¸ªæ–‡æœ¬å…ƒç´ å’Œ', foreignObjects.length, 'ä¸ª foreignObject');
        }

        function reRender() {
            const container = document.getElementById('infographic-container');
            container.innerHTML = '';

            let syntaxContent = document.getElementById('syntax-input').value.trim();

            if (typeof AntVInfographic === 'undefined') {
                container.innerHTML = '<div style="color: red; padding: 20px;">âš ï¸ AntV Infographic åº“æœªåŠ è½½</div>';
                return;
            }

            // åº”ç”¨æ¨¡æ¿æ˜ å°„ï¼ˆä¸æ’ä»¶ä¿æŒä¸€è‡´ï¼‰
            const TEMPLATE_MAPPING = {
                'list-grid': 'list-grid-compact-card',
                'list-vertical': 'list-column-simple-vertical-arrow',
                'tree-vertical': 'hierarchy-tree-tech-style-capsule-item',
                'tree-horizontal': 'hierarchy-tree-lr-tech-style-capsule-item',
                'mindmap': 'hierarchy-mindmap-branch-gradient-capsule-item',
                'sequence-roadmap': 'sequence-roadmap-vertical-simple',
                'sequence-zigzag': 'sequence-horizontal-zigzag-simple',
                'sequence-horizontal': 'sequence-horizontal-zigzag-simple',
                'relation-sankey': 'relation-sankey-simple',
                'relation-circle': 'relation-circle-icon-badge',
                'compare-binary': 'compare-binary-horizontal-simple-vs',
                'compare-swot': 'compare-swot',
                'compare-table': 'compare-table-simple',
                'quadrant-quarter': 'quadrant-quarter-simple-card',
                'statistic-card': 'list-grid-compact-card',
                'chart-bar': 'chart-bar-plain-text',
                'chart-column': 'chart-column-simple',
                'chart-line': 'chart-line-plain-text',
                'chart-area': 'chart-area-simple',
                'chart-pie': 'chart-pie-plain-text',
                'chart-doughnut': 'chart-pie-donut-plain-text'
            };

            for (const [key, value] of Object.entries(TEMPLATE_MAPPING)) {
                const regex = new RegExp(`infographic\\s+${key}(?=\\s|$)`, 'i');
                if (regex.test(syntaxContent)) {
                    console.log(`[Debug] æ¨¡æ¿æ˜ å°„: ${key} -> ${value}`);
                    syntaxContent = syntaxContent.replace(regex, `infographic ${value}`);
                    break;
                }
            }

            try {
                const { Infographic } = AntVInfographic;
                const instance = new Infographic({
                    container: '#infographic-container',
                    padding: 24,
                });
                instance.render(syntaxContent);
                console.log('[Debug] æ¸²æŸ“å®Œæˆ');

                // æ¸²æŸ“å®Œæˆååº”ç”¨æ ·å¼
                setTimeout(() => {
                    applyStyles();
                }, 300);
            } catch (error) {
                container.innerHTML = '<div style="color: red; padding: 20px;">âš ï¸ æ¸²æŸ“é”™è¯¯: ' + error.message + '</div>';
                console.error(error);
            }
        }

        // é¡µé¢åŠ è½½åè‡ªåŠ¨æ¸²æŸ“
        window.onload = function () {
            setTimeout(reRender, 500);
        };
    </script>
</body>

</html>
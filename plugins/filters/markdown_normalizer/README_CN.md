# Markdown æ ¼å¼åŒ–è¿‡æ»¤å™¨ (Markdown Normalizer)

**ä½œè€…:** [Fu-Jie](https://github.com/Fu-Jie/openwebui-extensions) | **ç‰ˆæœ¬:** 1.2.4 | **é¡¹ç›®:** [OpenWebUI Extensions](https://github.com/Fu-Jie/openwebui-extensions) | **è®¸å¯è¯:** MIT

è¿™æ˜¯ä¸€ä¸ªç”¨äº Open WebUI çš„å†…å®¹æ ¼å¼åŒ–è¿‡æ»¤å™¨ï¼Œæ—¨åœ¨ä¿®å¤ LLM è¾“å‡ºä¸­å¸¸è§çš„ Markdown æ ¼å¼é—®é¢˜ã€‚å®ƒèƒ½ç¡®ä¿ä»£ç å—ã€LaTeX å…¬å¼ã€Mermaid å›¾è¡¨å’Œå…¶ä»– Markdown å…ƒç´ è¢«æ­£ç¡®æ¸²æŸ“ã€‚

## ğŸ”¥ æœ€æ–°æ›´æ–° v1.2.4

* **æ–‡æ¡£æ›´æ–°**: åŒæ­¥äº†æ‰€æœ‰æ–‡æ¡£å’Œä»£ç æ–‡ä»¶çš„ç‰ˆæœ¬å·ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

* **Details æ ‡ç­¾è§„èŒƒåŒ–**: ç¡®ä¿ `<details>` æ ‡ç­¾ï¼ˆå¸¸ç”¨äºæ€ç»´é“¾ï¼‰æœ‰æ­£ç¡®çš„é—´è·ã€‚åœ¨ `</details>` åæ·»åŠ ç©ºè¡Œï¼Œå¹¶åœ¨è‡ªé—­åˆ `<details />` æ ‡ç­¾åæ·»åŠ æ¢è¡Œï¼Œé˜²æ­¢æ¸²æŸ“é—®é¢˜ã€‚
* **å¼ºè°ƒç©ºæ ¼ä¿®å¤**: ä¿®å¤å¼ºè°ƒæ ‡è®°å†…éƒ¨çš„å¤šä½™ç©ºæ ¼ï¼ˆä¾‹å¦‚ `** æ–‡æœ¬ **` -> `**æ–‡æœ¬**`ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´ Markdown æ¸²æŸ“å¤±è´¥ã€‚åŒ…å«ä¿æŠ¤æœºåˆ¶ï¼Œé˜²æ­¢è¯¯ä¿®æ”¹æ•°å­¦è¡¨è¾¾å¼ï¼ˆå¦‚ `2 * 3 * 4`ï¼‰æˆ–åˆ—è¡¨å˜é‡ã€‚
* **Mermaid è¯­æ³•ä¿®å¤**: è‡ªåŠ¨ä¿®å¤å¸¸è§çš„ Mermaid è¯­æ³•é”™è¯¯ï¼Œå¦‚æœªåŠ å¼•å·çš„èŠ‚ç‚¹æ ‡ç­¾ï¼ˆæ”¯æŒå¤šè¡Œæ ‡ç­¾å’Œå¼•ç”¨æ ‡è®°ï¼‰å’Œæœªé—­åˆçš„å­å›¾ (Subgraph)ã€‚**v1.1.2 æ–°å¢**: å…¨é¢ä¿æŠ¤å„ç§ç±»å‹çš„è¿çº¿æ ‡ç­¾ï¼ˆå®çº¿ã€è™šçº¿ã€ç²—çº¿ï¼‰ï¼Œé˜²æ­¢è¢«è¯¯ä¿®æ”¹ã€‚
* **å‰ç«¯æ§åˆ¶å°è°ƒè¯•**: æ”¯æŒå°†ç»“æ„åŒ–çš„è°ƒè¯•æ—¥å¿—ç›´æ¥æ‰“å°åˆ°æµè§ˆå™¨æ§åˆ¶å° (F12)ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚
* **ä»£ç å—æ ¼å¼åŒ–**: ä¿®å¤ç ´æŸçš„ä»£ç å—å‰ç¼€ã€åç¼€å’Œç¼©è¿›é—®é¢˜ã€‚
* **LaTeX è§„èŒƒåŒ–**: æ ‡å‡†åŒ– LaTeX å…¬å¼å®šç•Œç¬¦ (`\[` -> `$$`, `\(` -> `$`)ã€‚
* **æ€ç»´æ ‡ç­¾è§„èŒƒåŒ–**: ç»Ÿä¸€æ€ç»´é“¾æ ‡ç­¾ (`<think>`, `<thinking>` -> `<thought>`)ã€‚
* **è½¬ä¹‰å­—ç¬¦ä¿®å¤**: æ¸…ç†è¿‡åº¦çš„è½¬ä¹‰å­—ç¬¦ (`\\n`, `\\t`)ã€‚
* **åˆ—è¡¨æ ¼å¼åŒ–**: ç¡®ä¿åˆ—è¡¨é¡¹æœ‰æ­£ç¡®çš„æ¢è¡Œã€‚
* **æ ‡é¢˜ä¿®å¤**: ä¿®å¤æ ‡é¢˜ä¸­ç¼ºå¤±çš„ç©ºæ ¼ (`#æ ‡é¢˜` -> `# æ ‡é¢˜`)ã€‚
* **è¡¨æ ¼ä¿®å¤**: ä¿®å¤è¡¨æ ¼ä¸­ç¼ºå¤±çš„é—­åˆç®¡é“ç¬¦ã€‚
* **XML æ¸…ç†**: ç§»é™¤æ®‹ç•™çš„ XML æ ‡ç­¾ã€‚

## ä½¿ç”¨æ–¹æ³•

1. åœ¨ Open WebUI ä¸­å®‰è£…æ­¤æ’ä»¶ã€‚
2. å…¨å±€å¯ç”¨æˆ–ä¸ºç‰¹å®šæ¨¡å‹å¯ç”¨æ­¤è¿‡æ»¤å™¨ã€‚
3. åœ¨ **Valves** è®¾ç½®ä¸­é…ç½®éœ€è¦å¯ç”¨çš„ä¿®å¤é¡¹ã€‚
4. (å¯é€‰) **æ˜¾ç¤ºè°ƒè¯•æ—¥å¿— (Show Debug Log)** åœ¨ Valves ä¸­é»˜è®¤å¼€å¯ã€‚è¿™ä¼šå°†ç»“æ„åŒ–çš„æ—¥å¿—æ‰“å°åˆ°æµè§ˆå™¨æ§åˆ¶å° (F12)ã€‚
    > [!WARNING]
    > ç”±äºè¿™æ˜¯åˆç‰ˆï¼Œå¯èƒ½ä¼šå‡ºç°â€œè´Ÿå‘ä¿®å¤â€çš„æƒ…å†µï¼ˆä¾‹å¦‚ç ´åäº†åŸæœ¬æ­£ç¡®çš„æ ¼å¼ï¼‰ã€‚å¦‚æœæ‚¨é‡åˆ°é—®é¢˜ï¼Œè¯·åŠ¡å¿…æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ï¼Œå¤åˆ¶â€œåŸå§‹ (Original)â€ä¸â€œè§„èŒƒåŒ– (Normalized)â€çš„å†…å®¹å¯¹æ¯”ï¼Œå¹¶æäº¤ Issue åé¦ˆã€‚

## é…ç½®å‚æ•° (Valves) âš™ï¸

| å‚æ•° | é»˜è®¤å€¼ | æè¿° |
| :--- | :--- | :--- |
| `priority` | `50` | è¿‡æ»¤å™¨ä¼˜å…ˆçº§ã€‚æ•°å€¼è¶Šå¤§è¶Šé åï¼ˆå»ºè®®åœ¨å…¶ä»–è¿‡æ»¤å™¨ä¹‹åè¿è¡Œï¼‰ã€‚ |
| `enable_escape_fix` | `True` | ä¿®å¤è¿‡åº¦çš„è½¬ä¹‰å­—ç¬¦ï¼ˆ`\n`, `\t` ç­‰ï¼‰ã€‚ |
| `enable_escape_fix_in_code_blocks` | `False` | åœ¨ä»£ç å—å†…åº”ç”¨è½¬ä¹‰ä¿®å¤ï¼ˆå¯èƒ½å½±å“æœ‰æ•ˆä»£ç ï¼‰ã€‚ |
| `enable_thought_tag_fix` | `True` | è§„èŒƒåŒ–æ€ç»´æ ‡ç­¾ï¼ˆ`</thought>`ï¼‰ã€‚ |
| `enable_details_tag_fix` | `True` | è§„èŒƒåŒ– `<details>` æ ‡ç­¾å¹¶æ·»åŠ å®‰å…¨é—´è·ã€‚ |
| `enable_code_block_fix` | `True` | ä¿®å¤ä»£ç å—æ ¼å¼ï¼ˆç¼©è¿›/æ¢è¡Œï¼‰ã€‚ |
| `enable_latex_fix` | `True` | è§„èŒƒåŒ– LaTeX å®šç•Œç¬¦ï¼ˆ`\[` -> `$$`, `\(` -> `$`ï¼‰ã€‚ |
| `enable_list_fix` | `False` | ä¿®å¤åˆ—è¡¨é¡¹æ¢è¡Œï¼ˆå®éªŒæ€§ï¼‰ã€‚ |
| `enable_unclosed_block_fix` | `True` | è‡ªåŠ¨é—­åˆæœªé—­åˆçš„ä»£ç å—ã€‚ |
| `enable_fullwidth_symbol_fix` | `False` | ä¿®å¤ä»£ç å—ä¸­çš„å…¨è§’ç¬¦å·ã€‚ |
| `enable_mermaid_fix` | `True` | ä¿®å¤å¸¸è§ Mermaid è¯­æ³•é”™è¯¯ã€‚ |
| `enable_heading_fix` | `True` | ä¿®å¤æ ‡é¢˜ä¸­ç¼ºå¤±çš„ç©ºæ ¼ã€‚ |
| `enable_table_fix` | `True` | ä¿®å¤è¡¨æ ¼ä¸­ç¼ºå¤±çš„é—­åˆç®¡é“ç¬¦ã€‚ |
| `enable_xml_tag_cleanup` | `True` | æ¸…ç†æ®‹ç•™çš„ XML æ ‡ç­¾ã€‚ |
| `enable_emphasis_spacing_fix` | `False` | ä¿®å¤å¼ºè°ƒè¯­æ³•ä¸­çš„å¤šä½™ç©ºæ ¼ã€‚ |
| `show_status` | `True` | åº”ç”¨ä¿®å¤æ—¶æ˜¾ç¤ºçŠ¶æ€é€šçŸ¥ã€‚ |
| `show_debug_log` | `True` | åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰“å°è°ƒè¯•æ—¥å¿—ã€‚ |

## â­ æ”¯æŒ

å¦‚æœè¿™ä¸ªæ’ä»¶å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿åˆ° [OpenWebUI Extensions](https://github.com/Fu-Jie/openwebui-extensions) ç‚¹ä¸ª Starï¼Œè¿™å°†æ˜¯æˆ‘æŒç»­æ”¹è¿›çš„åŠ¨åŠ›ï¼Œæ„Ÿè°¢æ”¯æŒã€‚

## å…¶ä»–

### æ•…éšœæ’é™¤ (Troubleshooting) â“

* **æäº¤ Issue**: å¦‚æœé‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·åœ¨ GitHub ä¸Šæäº¤ Issueï¼š[OpenWebUI Extensions Issues](https://github.com/Fu-Jie/openwebui-extensions/issues)

### æ›´æ–°æ—¥å¿—

å®Œæ•´å†å²è¯·æŸ¥çœ‹ GitHub é¡¹ç›®ï¼š [OpenWebUI Extensions](https://github.com/Fu-Jie/openwebui-extensions)
